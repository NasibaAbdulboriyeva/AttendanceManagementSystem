@model AttendanceSummaryViewModel
@{
    // Sahifa sarlavhasini belgilash
    ViewData["Title"] = "Сводка опозданий по сотрудникам";

    // Controller va Action nomlari to'g'ridan-to'g'ri belgilandi
    const string controllerName = "AdminAttendance";
    const string actionName = "LateArrivalsSummary";
}

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h2 style="color: green; margin: 0; font-weight: bold;">Отчет по неоправданным опозданиям</h2>
        <p style="color: #6c757d;">Общий лимит опозданий: 80 минут</p>
    </div>
    <div class="card-body">

        @* Oyni tanlash qismi: Faqat inline uslublar qoldi *@
        <form method="post" asp-action="@actionName" asp-controller="@controllerName" style="display: flex; align-items: center; margin-bottom: 1rem;">
            <label for="month-picker" style="margin-right: 0.5rem; margin-bottom: 0; font-weight: bold;">Выберите месяц для отчета:</label>
            <input type="month"
                   id="month-picker"
                   name="targetMonth"
                   style="border: 1px solid #ccc; padding: 0.375rem 0.75rem; border-radius: 0.25rem; margin-right: 0.5rem; width: 150px;"
                   value="@Model.TargetMonth.ToString("yyyy-MM")">
            <button type="submit" style="background-color: #007bff; color: white; border: none; padding: 0.375rem 0.75rem; border-radius: 0.25rem; cursor: pointer;">Показать отчет</button>
        </form>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; border: 1px solid #dee2e6;">
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="border: 1px solid #dee2e6; padding: 8px;">ФИО Сотрудника</th>
                        <th style="width: 150px; text-align: center; border: 1px solid #dee2e6; padding: 8px;">Общее опоздание (мин)</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var employee in Model.Employees)
                    {
                        var lateMinutes = employee.TotalLateMinutes;
                        const int monthlyLimit = 80;
                        var isOverLimit = lateMinutes > monthlyLimit;

                        // Limitdan oshgan holat uchun INLINE STYLE yaratish
                        string styleForLateMinutes = "";

                        if (isOverLimit)
                        {
                            // Qizil rang va qalin shrift (jirniy)
                            styleForLateMinutes = "color: red; font-weight: bold; font-size: 1.1em;";
                        }
                        else if (lateMinutes > 0)
                        {
                            // Limitdan oshmagan, ammo kech qolish bor
                            styleForLateMinutes = "color: orange;";
                        }
                        else
                        {
                            // Kechikish yo'q
                            styleForLateMinutes = "color: green;";
                        }


                        <tr data-employee-id="@employee.EmployeeId">
                            <td style="border: 1px solid #dee2e6; padding: 8px;">@employee.FullName</td>

                            @* Kech qolish minutlari (Opazdaniye) *@
                            <td style="text-align: center; border: 1px solid #dee2e6; padding: 8px;">
                                @if (lateMinutes > 0)
                                {
                                    <span style="@styleForLateMinutes">@lateMinutes</span>
                                }
                                else
                                {
                                    <span style="color: green;">0</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    @* JavaScript bloki endi kerak emas *@
}