@model AttendanceSummaryViewModel
@{
    ViewData["Title"] = "Сводка опозданий по сотрудникам";

    const string controllerName = "AdminAttendance";
    const string actionName = "LateArrivalsSummary";
}

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h2 style="color: green; margin: 0; font-weight: bold;">Общий ежемесячный отчет по опозданиям и сверх лимита</h2>
        <p style="color: #6c757d;">Общий лимит опозданий: @Model.MonthlyLimit минут</p>
    </div>
    <div class="card-body">

        <form method="post" asp-action="@actionName" asp-controller="@controllerName" style="display: flex; align-items: center; margin-bottom: 1rem;">
            <label for="month-picker" style="margin-right: 0.5rem; margin-bottom: 0; font-weight: bold;">Выберите месяц для отчета:</label>
            <input type="month"
                   id="month-picker"
                   name="targetMonth"
                   style="border: 1px solid #ccc; padding: 0.375rem 0.75rem; border-radius: 0.25rem; margin-right: 0.5rem; width: 150px;"
                   value="@Model.TargetMonth.ToString("yyyy-MM")">
            <button type="submit" style="background-color: #007bff; color: white; border: none; padding: 0.375rem 0.75rem; border-radius: 0.25rem; cursor: pointer;">Показать отчет</button>
        </form>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; border: 1px solid #dee2e6;">
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="border: 1px solid #dee2e6; padding: 8px;">ФИО Сотрудника</th>
                        <th style="width: 150px; text-align: center; border: 1px solid #dee2e6; padding: 8px;">Общее опоздание (мин)</th>

                       
                        <th style="width: 150px; text-align: center; border: 1px solid #dee2e6; padding: 8px; color: firebrick;">Сверхлимит опоздания (мин)</th>

                    </tr>
                </thead>
                <tbody>
                    @foreach (var employee in Model.Employees)
                    {
                        var lateMinutes = employee.TotalLateMinutes;

                        var isOverLimit = lateMinutes > @Model.MonthlyLimit;

                        var sverhLimitMinutes = isOverLimit ? (lateMinutes - @Model.MonthlyLimit) : 0;

                        string styleForLateMinutes = "";

                        if (isOverLimit)
                        {
                            styleForLateMinutes = "color: red; font-weight: bold; font-size: 1.1em;";
                        }
                        else if (lateMinutes > 0)
                        {
                            styleForLateMinutes = "color: orange;";
                        }
                        else
                        {
                            styleForLateMinutes = "color: green;";
                        }

                        <tr data-employee-id="@employee.EmployeeId">
                            <td style="border: 1px solid #dee2e6; padding: 8px;">@employee.FullName</td>

                            <td style="text-align: center; border: 1px solid #dee2e6; padding: 8px;">
                                @if (lateMinutes > 0)
                                {
                                    <span style="@styleForLateMinutes">@lateMinutes</span>
                                }
                                else
                                {
                                    <span style="color: green;">0</span>
                                }
                            </td>

                            <td style="text-align: center; border: 1px solid #dee2e6; padding: 8px;">
                                @if (sverhLimitMinutes > 0)
                                {
                                    <span style="color: red; font-weight: bold;">@sverhLimitMinutes</span>
                                }
                                else
                                {
                                    <span>0</span>
                                }
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
}