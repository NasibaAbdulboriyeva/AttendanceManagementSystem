@model AttendanceManagementSystem.Api.Models.EmployeeListViewModel

@{
    ViewData["Title"] = "Список Активных Сотрудников";
}
<style>
    /* 1. Asosiy Rang Sxemasi - YANGILANDI (Mint Green) */
    :root {
        --corporate-color: #66bb6a; /* Mint Green (Och Yashil) - Header va Primary uchun */
        --corporate-dark: #388e3c; /* To'q Yashil - Hover va Text uchun */
        --light-grey-bg: #f8f9fa;
        --border-color: #e0e0e0;
    }

    /* 2. Card va Umumiy Ko'rinish */
    .employee-card {
        margin-top: 30px;
        border-radius: 0.75rem;
        border: 1px solid var(--border-color);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.05); /* Yumshoq soya */
        overflow: hidden;
    }

    /* 3. Card Header - YANGILANDI */
    .card-header-custom {
        background-color: var(--corporate-color); /* Och Yashil fon */
        color: white; /* Oq matn */
        padding: 1rem 1.5rem;
        border-bottom: none;
    }

    /* 4. Jadval Uslubi */
    .table-striped > tbody > tr:nth-of-type(odd) {
        background-color: var(--light-grey-bg);
    }

    .table-hover tbody tr:hover {
        background-color: #e9ecef;
    }

    .action-cell {
        min-width: 180px;
    }

    /* 5. Qaytish Tugmasi - YANGILANDI */
    .btn-return-custom {
        background-color: transparent;
        color: white;
        border: 1px solid white;
        transition: all 0.2s;
    }

    .btn-return-custom:hover {
        background-color: white;
        color: var(--corporate-dark); /* Teskari rang - To'q Yashil */
    }
</style>


<div class="card employee-card">
    <div class="card-header-custom d-flex justify-content-between align-items-center">
        <h3 class="card-title mb-0"> 🔑Список Активных Сотрудников</h3>

        @* Boshqaruv paneliga qaytish tugmasi *@
        <a asp-controller="AdminAttendance" asp-action="Dashboard" class="btn btn-sm btn-return-custom shadow-sm">
            <i class="fas fa-arrow-left me-1"></i> Вернуться в панель управления
        </a>
    </div>

    <div class="card-body p-0">
        @if (Model.Employees == null || !Model.Employees.Any())
        {
            <div class="alert alert-info m-4" role="alert">
                В системе нет активных сотрудников для отображения.
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th style="width: 70%;">ФИО Сотрудника</th>
                            <th class="action-cell">Управление</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var employee in Model.Employees)
                        {
                            <tr>
                                <td>
                                    <strong>@employee.FullName</strong>
                                </td>

                                <td class="action-cell">
                                    @* ⭐ O'zgartirilgan tugma: onclick olib tashlandi, data atributlari qo'shildi *@
                                    <button type="button"
                                            class="btn btn-danger btn-sm deactivate-btn"
                                            data-bs-toggle="modal"
                                            data-bs-target="#DeactivationConfirmationModal"
                                            data-username="@employee.FullName"
                                            title="Деактивация сотрудника">
                                        <i class="fas fa-user-slash me-1"></i> Деактивировать
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>


@* ========================================================= *@
@* 2. Deaktivatsiya Modal Strukturasini qo'shish *@
@* ========================================================= *@

<div class="modal fade" id="DeactivationConfirmationModal" tabindex="-1" aria-labelledby="DeactivationConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="DeactivationConfirmationModalLabel"><i class="fas fa-user-slash me-2"></i> Подтверждение деактивации</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>
                    <strong class="text-danger">ВНИМАНИЕ! Вы действительно хотите деактивировать сотрудника <span id="employeeNameSpan" class="fw-bold"></span>?</strong>
                    <br><br>
                    Это действие **безвозвратно** удалит его из списка активных сотрудников .
                </p>
                @* Forma yo'naltirish uchun yashirin maydon *@
                <form id="DeactivateForm" asp-controller="AdminAttendance" asp-action="Inactivate" method="get">
                    <input type="hidden" id="deactivateUsernameInput" name="username" value="" />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" id="ConfirmDeactivateButton" class="btn btn-danger">Подтвердить</button>
            </div>
        </div>
    </div>
</div>

@* ========================================================= *@
@* 3. Javascript Mantiqini qo'shish *@
@* ========================================================= *@

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function () {
            const modalElement = document.getElementById('DeactivationConfirmationModal');

            // 1. Modal ochilishidan avval username'ni modal ichiga yozish
            modalElement.addEventListener('show.bs.modal', function (event) {
                // Modalni chaqirgan tugma topiladi
                const button = event.relatedTarget;

                // data-username atributidan xodimning FIOsi olinadi
                const username = button.getAttribute('data-username');

                // Modal ichidagi username ko'rsatiladigan joylar yangilanadi
                document.getElementById('employeeNameSpan').textContent = username;
                document.getElementById('deactivateUsernameInput').value = username;
            });

            // 2. Modal ichidagi "Подтвердить" tugmasi bosilganda formani yuborish
            $('#ConfirmDeactivateButton').on('click', function () {
                // Modal yopiladi
                const modalInstance = bootstrap.Modal.getInstance(modalElement);
                modalInstance.hide();

                // Yashirin formani submit qilish
                $('#DeactivateForm').submit();
            });
        });
    </script>
}